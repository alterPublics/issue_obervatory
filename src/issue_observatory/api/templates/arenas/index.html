{% extends "base.html" %}
{% block title %}Available Arenas{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto space-y-6">

    {# Page header #}
    <div>
        <h1 class="text-xl font-bold text-gray-900">Available Arenas</h1>
        <p class="text-sm text-gray-500 mt-0.5">
            Explore the platforms available for data collection in The Issue Observatory
        </p>
    </div>

    {# What Can I Research? Narrative section #}
    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow p-6 border border-blue-100">
        <h2 class="text-base font-semibold text-gray-900 mb-3">What Can I Research?</h2>
        <div class="space-y-3 text-sm text-gray-700">
            <p>
                The Issue Observatory provides access to <strong>{{ arenas | length }} data collection arenas</strong>
                spanning news media, social platforms, fringe communities, and web archives. Each arena serves a distinct
                research purpose in understanding how issues emerge and spread across the Danish digital media landscape.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                <div class="bg-white bg-opacity-60 rounded-md p-4 border border-blue-100">
                    <h3 class="text-sm font-semibold text-blue-900 mb-2">News & Mainstream Media</h3>
                    <p class="text-xs text-gray-600">
                        Monitor traditional news coverage through RSS feeds (DR, TV2, Politiken, Berlingske),
                        GDELT global news database, Event Registry, and Via Ritzau wire service. Track how
                        issues enter public discourse through established media.
                    </p>
                </div>
                <div class="bg-white bg-opacity-60 rounded-md p-4 border border-blue-100">
                    <h3 class="text-sm font-semibold text-indigo-900 mb-2">Social Media Platforms</h3>
                    <p class="text-xs text-gray-600">
                        Follow conversations on X/Twitter, Bluesky, Reddit, YouTube, Facebook, Instagram, Threads,
                        and TikTok. Analyze how issues are discussed, shared, and amplified across mainstream
                        social networks with diverse audience demographics.
                    </p>
                </div>
                <div class="bg-white bg-opacity-60 rounded-md p-4 border border-blue-100">
                    <h3 class="text-sm font-semibold text-purple-900 mb-2">Fringe & Alternative Platforms</h3>
                    <p class="text-xs text-gray-600">
                        Examine alternative discourse on Gab, Telegram, and Discord. These spaces often host
                        communities that may be underrepresented or marginalized from mainstream platforms,
                        offering insight into counter-narratives and emerging perspectives.
                    </p>
                </div>
                <div class="bg-white bg-opacity-60 rounded-md p-4 border border-blue-100">
                    <h3 class="text-sm font-semibold text-amber-900 mb-2">Web Archives & Search</h3>
                    <p class="text-xs text-gray-600">
                        Conduct historical analysis with Common Crawl and Wayback Machine, track search trends
                        via Google Search and Autocomplete, discover backlinks with Majestic, and explore AI-mediated
                        information access through AI Chat Search.
                    </p>
                </div>
            </div>
        </div>
    </div>

    {# Arena cards organized by tier #}
    <div class="space-y-6" x-data="arenaOverview()">

        {# Loading state #}
        <div x-show="loading" class="text-center py-12">
            <svg class="animate-spin w-8 h-8 text-blue-600 mx-auto" xmlns="http://www.w3.org/2000/svg"
                 fill="none" viewBox="0 0 24 24" aria-hidden="true">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/>
            </svg>
            <p class="text-sm text-gray-500 mt-3">Loading arenas...</p>
        </div>

        {# Error state #}
        <div x-show="error" class="bg-red-50 border border-red-200 rounded-lg p-4">
            <p class="text-sm text-red-700" x-text="error"></p>
        </div>

        {# Free Tier Section #}
        <div x-show="!loading && !error && freeArenas.length > 0">
            <div class="flex items-center gap-3 mb-3">
                <h2 class="text-base font-semibold text-gray-900">Free Tier</h2>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    No API costs
                </span>
                <span class="text-xs text-gray-500" x-text="freeArenas.length + ' arenas'"></span>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <template x-for="arena in freeArenas" :key="arena.platform_name">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-5 hover:shadow-md transition-shadow">
                        {# Header with status indicator #}
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1 min-w-0">
                                <h3 class="text-sm font-semibold text-gray-900 truncate" x-text="arena.platform_name"></h3>
                                <p class="text-xs text-gray-500 mt-0.5" x-text="arena.arena_name"></p>
                            </div>
                            <div class="flex-shrink-0 ml-2">
                                <span class="flex w-3 h-3 rounded-full"
                                      :class="arena.has_credentials ? 'bg-green-500' : 'bg-gray-300'"
                                      :title="arena.has_credentials ? 'Credentials configured' : 'No credentials configured'">
                                </span>
                            </div>
                        </div>

                        {# Description #}
                        <p class="text-xs text-gray-600 mb-3 line-clamp-3" x-text="arena.description"></p>

                        {# Supported tiers badges #}
                        <div class="flex flex-wrap gap-1.5 mb-3">
                            <template x-for="tier in arena.supported_tiers" :key="tier">
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"
                                      :class="{
                                          'bg-green-100 text-green-800': tier === 'free',
                                          'bg-blue-100 text-blue-800': tier === 'medium',
                                          'bg-purple-100 text-purple-800': tier === 'premium'
                                      }"
                                      x-text="tier.toUpperCase()">
                                </span>
                            </template>
                        </div>

                        {# Custom configuration indicator #}
                        <div x-show="arena.custom_config_fields && arena.custom_config_fields.length > 0">
                            <div class="text-xs text-blue-600 flex items-center gap-1.5 bg-blue-50 rounded px-2 py-1">
                                <svg class="w-3 h-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                     stroke="currentColor" stroke-width="2" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                <span>Configurable sources</span>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        {# Medium Tier Section #}
        <div x-show="!loading && !error && mediumArenas.length > 0">
            <div class="flex items-center gap-3 mb-3">
                <h2 class="text-base font-semibold text-gray-900">Medium Tier</h2>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    Paid APIs
                </span>
                <span class="text-xs text-gray-500" x-text="mediumArenas.length + ' arenas'"></span>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <template x-for="arena in mediumArenas" :key="arena.platform_name">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-5 hover:shadow-md transition-shadow">
                        {# Header with status indicator #}
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1 min-w-0">
                                <h3 class="text-sm font-semibold text-gray-900 truncate" x-text="arena.platform_name"></h3>
                                <p class="text-xs text-gray-500 mt-0.5" x-text="arena.arena_name"></p>
                            </div>
                            <div class="flex-shrink-0 ml-2">
                                <span class="flex w-3 h-3 rounded-full"
                                      :class="arena.has_credentials ? 'bg-green-500' : 'bg-gray-300'"
                                      :title="arena.has_credentials ? 'Credentials configured' : 'No credentials configured'">
                                </span>
                            </div>
                        </div>

                        {# Description #}
                        <p class="text-xs text-gray-600 mb-3 line-clamp-3" x-text="arena.description"></p>

                        {# Supported tiers badges #}
                        <div class="flex flex-wrap gap-1.5 mb-3">
                            <template x-for="tier in arena.supported_tiers" :key="tier">
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"
                                      :class="{
                                          'bg-green-100 text-green-800': tier === 'free',
                                          'bg-blue-100 text-blue-800': tier === 'medium',
                                          'bg-purple-100 text-purple-800': tier === 'premium'
                                      }"
                                      x-text="tier.toUpperCase()">
                                </span>
                            </template>
                        </div>

                        {# Custom configuration indicator #}
                        <div x-show="arena.custom_config_fields && arena.custom_config_fields.length > 0">
                            <div class="text-xs text-blue-600 flex items-center gap-1.5 bg-blue-50 rounded px-2 py-1">
                                <svg class="w-3 h-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                     stroke="currentColor" stroke-width="2" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                <span>Configurable sources</span>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        {# Premium Tier Section #}
        <div x-show="!loading && !error && premiumArenas.length > 0">
            <div class="flex items-center gap-3 mb-3">
                <h2 class="text-base font-semibold text-gray-900">Premium Tier</h2>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                    Enterprise APIs
                </span>
                <span class="text-xs text-gray-500" x-text="premiumArenas.length + ' arenas'"></span>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <template x-for="arena in premiumArenas" :key="arena.platform_name">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-5 hover:shadow-md transition-shadow">
                        {# Header with status indicator #}
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1 min-w-0">
                                <h3 class="text-sm font-semibold text-gray-900 truncate" x-text="arena.platform_name"></h3>
                                <p class="text-xs text-gray-500 mt-0.5" x-text="arena.arena_name"></p>
                            </div>
                            <div class="flex-shrink-0 ml-2">
                                <span class="flex w-3 h-3 rounded-full"
                                      :class="arena.has_credentials ? 'bg-green-500' : 'bg-gray-300'"
                                      :title="arena.has_credentials ? 'Credentials configured' : 'No credentials configured'">
                                </span>
                            </div>
                        </div>

                        {# Description #}
                        <p class="text-xs text-gray-600 mb-3 line-clamp-3" x-text="arena.description"></p>

                        {# Supported tiers badges #}
                        <div class="flex flex-wrap gap-1.5 mb-3">
                            <template x-for="tier in arena.supported_tiers" :key="tier">
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"
                                      :class="{
                                          'bg-green-100 text-green-800': tier === 'free',
                                          'bg-blue-100 text-blue-800': tier === 'medium',
                                          'bg-purple-100 text-purple-800': tier === 'premium'
                                      }"
                                      x-text="tier.toUpperCase()">
                                </span>
                            </template>
                        </div>

                        {# Custom configuration indicator #}
                        <div x-show="arena.custom_config_fields && arena.custom_config_fields.length > 0">
                            <div class="text-xs text-blue-600 flex items-center gap-1.5 bg-blue-50 rounded px-2 py-1">
                                <svg class="w-3 h-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                     stroke="currentColor" stroke-width="2" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                <span>Configurable sources</span>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        {# Empty state #}
        <div x-show="!loading && !error && freeArenas.length === 0 && mediumArenas.length === 0 && premiumArenas.length === 0"
             class="text-center py-12 bg-white rounded-lg shadow">
            <svg class="w-12 h-12 text-gray-300 mx-auto mb-3" xmlns="http://www.w3.org/2000/svg" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
            </svg>
            <p class="text-sm text-gray-500">No arenas available</p>
        </div>

    </div>

    {# Call to action #}
    <div class="bg-white rounded-lg shadow p-6 border-t-4 border-blue-500">
        <h2 class="text-base font-semibold text-gray-900 mb-2">Ready to Start Collecting?</h2>
        <p class="text-sm text-gray-600 mb-4">
            Create a query design to define your research questions and select which arenas to collect data from.
        </p>
        <a href="/query-designs/new"
           class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition-colors">
            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
            </svg>
            Create Query Design
        </a>
    </div>

</div>

{# Alpine.js component for arena data management #}
<script>
function arenaOverview() {
    return {
        loading: true,
        error: null,
        arenas: [],
        freeArenas: [],
        mediumArenas: [],
        premiumArenas: [],

        async init() {
            try {
                const response = await fetch('/api/arenas/');
                if (!response.ok) {
                    throw new Error('Failed to fetch arenas');
                }
                this.arenas = await response.json();
                this.categorizeArenas();
            } catch (err) {
                this.error = 'Failed to load arena data: ' + err.message;
            } finally {
                this.loading = false;
            }
        },

        categorizeArenas() {
            // Sort arenas by platform name for consistent display
            this.arenas.sort((a, b) => a.platform_name.localeCompare(b.platform_name));

            // Categorize by tier
            // An arena belongs to a tier category if it supports that tier
            this.freeArenas = this.arenas.filter(a => a.supported_tiers.includes('free'));
            this.mediumArenas = this.arenas.filter(a =>
                a.supported_tiers.includes('medium') && !a.supported_tiers.includes('free')
            );
            this.premiumArenas = this.arenas.filter(a =>
                a.supported_tiers.includes('premium') &&
                !a.supported_tiers.includes('free') &&
                !a.supported_tiers.includes('medium')
            );

            // For arenas that support multiple tiers, show them in the lowest tier they support
            // This is already handled by the filters above (free first, then medium, then premium only)
        }
    };
}
</script>
{% endblock %}
