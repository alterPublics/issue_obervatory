{#
    Left sidebar navigation.
    Expects: request (for URL matching to highlight the active route)
    Optional: user (may be None if included from a page that allows anonymous access)
#}
<nav class="w-64 bg-white shadow-sm min-h-screen flex flex-col flex-shrink-0">
    {# Brand header #}
    <div class="p-4 border-b border-gray-200">
        <a href="/dashboard" class="block">
            <h1 class="text-base font-bold text-gray-900 leading-tight">Issue Observatory</h1>
            <p class="text-xs text-gray-500 mt-0.5">Danish media monitor</p>
        </a>
    </div>

    {# Primary navigation links #}
    <ul class="flex-1 py-4 space-y-0.5 px-2" role="list">
        {% set nav_items = [
            ('Dashboard',       '/dashboard',       'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6'),
            ('Projects',        '/projects',        'M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z'),
            ('Explore',         '/explore',         'M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'),
            ('Collections',     '/collections',     'M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12'),
            ('Content',         '/content',         'M4 6h16M4 10h16M4 14h16M4 18h16'),
            ('Actors',          '/actors',          'M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0'),
            ('Analysis',        '/analysis',        'M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z'),
        ] %}
        {% for label, href, icon_path in nav_items %}
            {% set is_active = request.url.path == href or request.url.path.startswith(href + '/') %}
            <li>
                <a href="{{ href }}"
                   class="flex items-center gap-3 px-3 py-2 rounded-md text-sm font-medium transition-colors
                          {% if is_active %}bg-blue-50 text-blue-700{% else %}text-gray-700 hover:bg-gray-100 hover:text-gray-900{% endif %}">
                    <svg class="w-4 h-4 flex-shrink-0 {% if is_active %}text-blue-600{% else %}text-gray-400{% endif %}"
                         xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                         stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="{{ icon_path }}"/>
                    </svg>
                    {{ label }}
                </a>
            </li>
        {% endfor %}

        {# Tools section #}
        <li class="pt-4">
            <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1">Tools</p>
        </li>
        {% set tool_items = [
            ('Scraping Jobs', '/scraping-jobs', 'M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7'),
            ('Import Data',   '/imports',       'M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12'),
        ] %}
        {% for label, href, icon_path in tool_items %}
            {% set is_active = request.url.path == href or request.url.path.startswith(href + '/') %}
            <li>
                <a href="{{ href }}"
                   class="flex items-center gap-3 px-3 py-2 rounded-md text-sm font-medium transition-colors
                          {% if is_active %}bg-blue-50 text-blue-700{% else %}text-gray-600 hover:bg-gray-100 hover:text-gray-900{% endif %}">
                    <svg class="w-4 h-4 flex-shrink-0 {% if is_active %}text-blue-600{% else %}text-gray-400{% endif %}"
                         xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                         stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="{{ icon_path }}"/>
                    </svg>
                    {{ label }}
                </a>
            </li>
        {% endfor %}

        {# Reference section #}
        <li class="pt-4">
            <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1">Reference</p>
        </li>
        {% set ref_items = [
            ('Arenas', '/arenas', 'M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10'),
        ] %}
        {% for label, href, icon_path in ref_items %}
            {% set is_active = request.url.path == href or request.url.path.startswith(href + '/') %}
            <li>
                <a href="{{ href }}"
                   class="flex items-center gap-3 px-3 py-2 rounded-md text-sm font-medium transition-colors
                          {% if is_active %}bg-blue-50 text-blue-700{% else %}text-gray-600 hover:bg-gray-100 hover:text-gray-900{% endif %}">
                    <svg class="w-4 h-4 flex-shrink-0 {% if is_active %}text-blue-600{% else %}text-gray-400{% endif %}"
                         xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                         stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="{{ icon_path }}"/>
                    </svg>
                    {{ label }}
                </a>
            </li>
        {% endfor %}

        {# Admin section â€” only shown when user has admin role #}
        {% if user and user.role == 'admin' %}
            <li class="pt-4">
                <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1">Administration</p>
            </li>
            {% set admin_items = [
                ('Users',            '/admin/users',       'M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z'),
                ('Credits',          '/admin/credits',     'M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z'),
                ('API Keys',         '/admin/credentials', 'M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z'),
                ('System Status',    '/admin/health',      'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'),
            ] %}
            {% for label, href, icon_path in admin_items %}
                {% set is_active = request.url.path == href or request.url.path.startswith(href + '/') %}
                <li>
                    <a href="{{ href }}"
                       class="flex items-center gap-3 px-3 py-2 rounded-md text-sm font-medium transition-colors
                              {% if is_active %}bg-blue-50 text-blue-700{% else %}text-gray-600 hover:bg-gray-100 hover:text-gray-900{% endif %}">
                        <svg class="w-4 h-4 flex-shrink-0 {% if is_active %}text-blue-600{% else %}text-gray-400{% endif %}"
                             xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                             stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="{{ icon_path }}"/>
                        </svg>
                        {{ label }}
                    </a>
                </li>
            {% endfor %}
        {% endif %}
    </ul>

    {# Footer: credit balance + user info #}
    <div class="p-4 border-t border-gray-200 space-y-3">
        {% include '_partials/credit_badge.html' %}

        {% if user %}
        <div class="flex items-center gap-2 text-sm">
            <div class="w-7 h-7 rounded-full bg-blue-600 text-white flex items-center justify-center text-xs font-bold flex-shrink-0">
                {{ (user.display_name or user.email or '?')[0] | upper }}
            </div>
            <div class="min-w-0 flex-1">
                <p class="font-medium text-gray-900 truncate">{{ user.display_name or user.email or '' }}</p>
                <p class="text-xs text-gray-500 truncate">{{ user.email | default('') }}</p>
            </div>
        </div>
        <form method="post" action="/auth/cookie/logout" style="display:inline;" class="w-full">
            <button type="submit"
                    class="block w-full text-center text-xs text-gray-500 hover:text-red-600 transition-colors py-1 bg-transparent border-0 cursor-pointer">
                Sign out
            </button>
        </form>
        {% endif %}
    </div>
</nav>
